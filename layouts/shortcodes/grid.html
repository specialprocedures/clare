{{- $dir := .Get "dir" | default (.Get 0) | default "images" -}}
{{- $columns := .Get "columns" | default (.Get 1) | default "2" -}}
{{- $gap := .Get "gap" | default "10px" -}}
{{- $aspect := .Get "aspect" | default "square" -}}
{{- $gridId := printf "grid-%s" ($dir | replaceRE "[^a-zA-Z0-9]+" "-") -}}

<div class="square-grid-{{ $gridId }}" data-aspect="{{ $aspect }}">
  {{- $images := slice -}}
  {{- range (readDir (printf "static/%s" $dir)) -}}
  {{- if and (not .IsDir) (in (slice ".jpg" ".jpeg" ".png" ".gif" ".webp") (path.Ext .Name | lower)) -}}
  {{- $images = $images | append . -}}
  {{- end -}}
  {{- end -}}
  {{- range $index, $image := $images -}}
  <div class="grid-item">
    <img src="/{{ $dir }}/{{ $image.Name }}" alt="Image {{ $index }}">
  </div>
  {{- end -}}
</div>

<style>
.square-grid-{{ $gridId }} {
  display: grid;
  grid-template-columns: repeat({{ $columns }}, 1fr);
  gap: {{ $gap }};
  width: 100%;
}

/* Square aspect ratio */
.square-grid-{{ $gridId }}[data-aspect="square"] .grid-item {
  position: relative;
  width: 100%;
  padding-bottom: 100%;
  overflow: hidden;
  background: #f0f0f0;
}

.square-grid-{{ $gridId }}[data-aspect="square"] .grid-item img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Original aspect ratio */
.square-grid-{{ $gridId }}[data-aspect="original"] .grid-item {
  width: 100%;
}

.square-grid-{{ $gridId }}[data-aspect="original"] .grid-item img {
  width: 100%;
  height: auto;
  display: block;
}

@media (max-width: 768px) {
  .square-grid-{{ $gridId }} {
    grid-template-columns: repeat({{ if gt (int $columns) 2 }}2{{ else }}{{ $columns }}{{ end }}, 1fr);
  }
}

@media (max-width: 480px) {
  .square-grid-{{ $gridId }} {
    grid-template-columns: 1fr;
  }
}
</style>
